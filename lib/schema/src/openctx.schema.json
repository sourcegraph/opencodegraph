{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "openctx.schema.json#",
  "title": "Schema",
  "description": "Metadata about code",
  "allowComments": true,
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "annotations": {
      "type": "array",
      "items": { "$ref": "#/definitions/Annotation" }
    }
  },
  "definitions": {
    "Annotation": {
      "description": "An annotation describes information relevant to a file (or a range within a file).",
      "type": "object",
      "additionalProperties": false,
      "required": ["title"],
      "properties": {
        "title": {
          "description": "A descriptive title of the annotation.",
          "type": "string"
        },
        "url": {
          "description": "An external URL with more information about the annotation.",
          "type": "string",
          "format": "uri"
        },
        "ui": {
          "description": "The human user interface of the annotation, with information for human consumption.",
          "$ref": "#/definitions/UserInterface"
        },
        "ai": {
          "description": "Information from the annotation intended for consumption by AI, not humans.",
          "$ref": "#/definitions/AssistantInfo"
        },
        "range": {
          "description": "The range in the file that this annotation applies to. If not set, the annotation applies to the entire file.",
          "$ref": "#/definitions/Range"
        }
      }
    },
    "UserInterface": {
      "description": "The human user interface of an annotation, with information for human consumption.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "detail": {
          "description": "Text containing additional details for the human, shown when they interact with the annotation.",
          "type": "string"
        },
        "format": {
          "description": "The format of the title and description (Markdown or plain text).",
          "type": "string",
          "enum": ["markdown", "plaintext"]
        },
        "group": {
          "description": "If set, this annotation is grouped together with all other annotations with the same `group` value.",
          "type": "string"
        },
        "presentationHints": {
          "description": "Hints about the best way to present this annotation. Different clients interpret hints differently because they have different user interfaces.",
          "type": "array",
          "items": {
            "title": "PresentationHint",
            "description": "A hint about how to best present an annotation to the human in the client's user interface.\n\n- `show-at-top-of-file`: Group all annotations with the same `ui.group` value together and display them at the top of the file instead of at their given file range.\n- `prefer-link-over-detail`: Prefer to show the annotation as a link over showing the detail text, if the client does not cleanly support doing both.",
            "type": "string",
            "enum": ["show-at-top-of-file", "prefer-link-over-detail"]
          }
        }
      }
    },
    "AssistantInfo": {
      "description": "Information from an annotation intended for consumption by AI, not humans.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "content": {
          "description": "Text content for AI to consume.",
          "type": "string"
        }
      }
    },
    "Range": {
      "type": "object",
      "additionalProperties": false,
      "required": ["start", "end"],
      "properties": {
        "start": { "$ref": "#/definitions/Position" },
        "end": { "$ref": "#/definitions/Position" }
      }
    },
    "Position": {
      "type": "object",
      "additionalProperties": false,
      "required": ["line", "character"],
      "properties": { "line": { "type": "integer" }, "character": { "type": "integer" } }
    }
  }
}
